<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Conexi칩n - Sistema Bucodental</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #2A6FB6 0%, #1e52a8 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: none;
            border-radius: 15px;
        }
        .test-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .loading {
            color: #ffc107;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card" style="max-width: 500px;">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">游댢 Prueba de Sistema - Bucodental</h5>
            </div>
            <div class="card-body p-0">
                <div id="testContainer"></div>
            </div>
        </div>
    </div>

    <script>
        const tests = [
            {
                nombre: 'Conexi칩n a API',
                test: async () => {
                    try {
                        const res = await fetch('api.php?action=obtener_citas');
                        return res.ok ? 'API conectada' : 'Error en API';
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            },
            {
                nombre: 'Base de Datos',
                test: async () => {
                    try {
                        const res = await fetch('api.php?action=obtener_citas');
                        const data = await res.json();
                        if (data.success) {
                            return 'BD conectada (' + (data.citas?.length || 0) + ' citas)';
                        } else {
                            return 'Error: ' + (data.message || 'Desconocido');
                        }
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            },
            {
                nombre: 'Tabla de Administradores',
                test: async () => {
                    try {
                        const res = await fetch('api.php?action=obtener_admins');
                        const data = await res.json();
                        if (data.success) {
                            return 'Tabla OK (' + (data.administradores?.length || 0) + ' usuarios)';
                        } else {
                            return 'Error: ' + (data.message || 'Desconocido');
                        }
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            },
            {
                nombre: 'Tabla de Servicios',
                test: async () => {
                    try {
                        const res = await fetch('api.php?action=obtener_servicios');
                        const data = await res.json();
                        if (data.success) {
                            return 'Tabla OK (' + (data.servicios?.length || 0) + ' servicios)';
                        } else {
                            return 'Error: ' + (data.message || 'Desconocido');
                        }
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            },
            {
                nombre: 'Login Admin',
                test: async () => {
                    try {
                        const res = await fetch('api.php?action=login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ usuario: 'admin', password: '1234' })
                        });
                        const data = await res.json();
                        return data.success ? 'Autenticaci칩n OK' : 'Credenciales incorrectas';
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            },
            {
                nombre: 'Archivos Est치ticos',
                test: async () => {
                    try {
                        const res = await fetch('Index.html');
                        return res.ok ? 'Archivos accesibles' : 'Error accediendo archivos';
                    } catch (e) {
                        return 'Error: ' + e.message;
                    }
                }
            }
        ];

        async function runTests() {
            const container = document.getElementById('testContainer');
            
            for (const test of tests) {
                const item = document.createElement('div');
                item.className = 'test-item';
                item.innerHTML = `<span>${test.nombre}</span>: <span class="loading">Comprobando...</span>`;
                container.appendChild(item);
            }

            for (let i = 0; i < tests.length; i++) {
                try {
                    const resultado = await tests[i].test();
                    const items = document.querySelectorAll('.test-item');
                    const isError = resultado.toLowerCase().includes('error');
                    items[i].innerHTML = `<span>${tests[i].nombre}</span>: <span class="${isError ? 'error' : 'success'}">${resultado}</span>`;
                } catch (e) {
                    const items = document.querySelectorAll('.test-item');
                    items[i].innerHTML = `<span>${tests[i].nombre}</span>: <span class="error">Error: ${e.message}</span>`;
                }
            }

            // Agregar botones
            const footer = document.createElement('div');
            footer.className = 'p-3 border-top text-center';
            footer.innerHTML = `
                <a href="Index.html" class="btn btn-primary btn-sm">Ir a P치gina Principal</a>
                <a href="admin.html" class="btn btn-warning btn-sm">Ir a Admin</a>
            `;
            container.appendChild(footer);
        }

        // Ejecutar pruebas cuando carga la p치gina
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
